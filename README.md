# Описание
Этот репозиторий содержит микросервис для выдачи музыкальных рекомендаций.
Код сервиса — в файле `recommendations_service.py`.
Необходимые библиотеки описаны в `requirements.txt`.

## Активация виртуального окружения

Создать новое виртуальное окружение можно командой:

```
python3 -m venv env_recsys_start
```

После его инициализации следующей командой

```
. env_recsys_start/bin/activate
```

установите в него необходимые Python-пакеты следующей командой

```
pip install -r requirements.txt
```

# Расчёт рекомендаций

Код для выполнения первой части проекта находится в файле `recommendations.ipynb`.

# Сервис рекомендаций

Код сервиса рекомендаций находится в файле `recommendations_service.py`.
Запустите сервис из командной строки, находясь в папке с кодом
```
uvicorn recommendations_service:app
```
Сервис будет доступен по адресу: http://127.0.0.1:8000

## Эндпоинты сервиса
`/recommendations`
Основной эндпоинт. Принимает user_id, возвращает рекомендации, смешивая онлайн- и офлайн-результаты (если есть история пользователя).

`/get_online_rec`
Возвращает онлайн-рекомендации, сгенерированные моделью ALS. По последним событиям пользователя выбираются похожие треки. Модель берётся из файла als_model.npz, данные для перекодировки — из items.parquet.

`/put_user_event`
Сохраняет событие: user_id прослушал item_id.

`/get_user_events`
Возвращает последние k событий пользователя.

`/load_recommendations`
Загружает оффлайн-рекомендации из файла (если данные обновились).

`/get_statistics`
Возвращает текущую статистику обращений к сервису.

# Инструкции для тестирования сервиса

Код для тестирования сервиса находится в файле `test_service.py`.
Вывод сохранияется в файле test_service.log.
Также сервис можно протестировать по адресу http://127.0.0.1:8000/docs#/


# Выводы

Сервис обрабатывает запросы и возвращает рекомендации.

Реализована логика смешивания офлайн- и онлайн-рекомендаций.

Вся история пользователя учитывается.

Код протестирован для разных сценариев.
